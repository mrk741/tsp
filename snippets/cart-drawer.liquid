{{ 'component-cart-drawer.css' | asset_url | stylesheet_tag }}
{%- if  settings.enable_cart_drawer -%}
    <script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{%- liquid
    if cart_drawer_settings.enable_offer and cart_drawer_settings.offer_heading != blank
        assign offer_uppercase_heading = false
        if cart_drawer_settings.offer_heading_style == 'section-heading' and settings.uppercase_section_headings
            assign offer_uppercase_heading = true
        elsif cart_drawer_settings.offer_heading_style == 'secondary-heading' and settings.uppercase_secondary_headings
            assign offer_uppercase_heading = true
        elsif cart_drawer_settings.offer_heading_style == 'subheading-font' and settings.uppercase_subheadings
            assign offer_uppercase_heading = true
        elsif cart_drawer_settings.offer_heading_style == 'body-font' and settings.uppercase_body
            assign offer_uppercase_heading = true
        elsif cart_drawer_settings.offer_heading_style == 'caption-font' and settings.uppercase_caption
            assign offer_uppercase_heading = true
        endif
    endif

    assign onload_script = ''
    if settings.images_loading != 'disable'
        assign onload_script = 'this.parentNode.classList.add("lazyloaded");' 
    endif

    assign recommendations_uppercase_heading = false
    if cart_drawer_settings.recommendations_heading_style == 'caption-font' and settings.uppercase_caption
        assign recommendations_uppercase_heading = true
    elsif cart_drawer_settings.recommendations_heading_style == 'body-font' and settings.uppercase_body
        assign recommendations_uppercase_heading = true
    elsif cart_drawer_settings.recommendations_heading_style == 'secondary-heading' and settings.uppercase_secondary_headings
        assign recommendations_uppercase_heading = true
    elsif cart_drawer_settings.recommendations_heading_style == 'section-heading' and settings.uppercase_section_headings
        assign recommendations_uppercase_heading = true
    elsif cart_drawer_settings.recommendations_heading_style == 'page-title' and settings.uppercase_page_titles
        assign recommendations_uppercase_heading = true
    endif 

    assign uppercase_product_title = false
    if settings.small_product_titles_uppercase
      assign uppercase_product_title = true
    endif

    assign enable_side_panel = false
    if cart_drawer_settings.cart_recommendations_desktop_style == 'side-panel'
        assign enable_side_panel = true
    endif

    assign recommendations_block_has_different_bg = false
    if section.settings.color_scheme != settings.drawer_color_scheme
        assign recommendations_block_has_different_bg = true
    endif
-%}

<cart-drawer class="cart-drawer {% if cart == empty %}is-empty{% endif %} {% if settings.action_after_adding_to_cart == 'drawer' %}open-after-adding{% endif %}" 
    data-recommendations-block-has-different-bg="{{ recommendations_block_has_different_bg }}"
    data-enable-shadow="{{ settings.modal_enable_shadow }}"
    data-enable-border="{{ settings.modal_border }}"
>
    <div id="CartDrawer" class="drawer hide-scrollbar modal{% if settings.modal_enable_shadow %} modal--shadow{% endif %}{% if settings.modal_border %} modal--border{% endif %}{% if enable_side_panel and cart_drawer_settings.enable_cart_recommendations %} drawer--with-side-panel {% endif %}"  
        role="dialog" aria-modal="true" aria-label="{{ 'cart.title' | t }}"
    >
        <div class="cart-drawer__inner flex--column color-{{ settings.drawer_color_scheme }}">
            <div class="cart-drawer__inner-wrapper scroll-area hide-scrollbar">
                <div class="button-wrapper">
                    <button class="cart-drawer__close button-close close-popup icon--large" type="button" onclick="this.closest('cart-drawer').close()" aria-label="{{ 'accessibility.close' | t }}">
                        {%- render 'glyphs_interface', icon: 'close' -%}
                    </button>
                </div>
                <div class="cart-drawer__header">
                    {% if cart == empty %}
                        <h2 class="cart-page__empty-text secondary-heading{% if settings.uppercase_secondary_headings %} uppercase{% endif %}">
                            {%- if settings.cart_name == 'cart' -%}{{ 'cart.empty_cart' | t }}{%- elsif settings.cart_name == 'basket' -%}{{ 'cart.empty_basket' | t }}{%- else -%}{{ 'cart.empty_bag' | t }}{%- endif -%}
                        </h2>
                    {% else %}
                        <h2 class="cart-drawer__heading secondary-heading{% if settings.uppercase_secondary_headings %} uppercase{% endif %}">{%- if settings.cart_name == 'cart' -%}{{ 'cart_drawer.your_cart' | t }}{%- elsif settings.cart_name == 'basket' -%}{{ 'cart_drawer.your_basket' | t }}{%- else -%}{{ 'cart_drawer.your_bag' | t }}{%- endif -%}{{ cart.item_count | prepend: ' '}}</h2>
                    {% endif %}
                </div>
                {%- if cart == empty -%}
                    <div class="cart-empty__actions">
                        {%- if shop.customer_accounts_enabled and customer == null -%}
                            <a href="{{ routes.account_login_url }}" class="button solid-button body-font button--secondary{% if settings.use_heading_font_secondary_buttons %} heading-font-style{% endif %}{% if settings.uppercase_secondary_buttons %} uppercase{% endif %}">
                            {% if settings.bolder_secondary_buttons_font %}<b>{% endif %}{{ 'cart.login' | t }}{% if settings.bolder_secondary_buttons_font %}</b>{% endif %}
                        </a>
                        {%- endif -%}
                        <a href="{{ routes.root_url }}" class="button outlined-button body-font button--secondary{% if settings.use_heading_font_secondary_buttons %} heading-font-style{% endif %}{% if settings.uppercase_secondary_buttons %} uppercase{% endif %}">
                            {% if settings.bolder_secondary_buttons_font %}<b>{% endif %} {{ 'cart.continue_shopping' | t }}{% if settings.bolder_secondary_buttons_font %}</b>{% endif %}
                        </a>
                    </div>
                {%- else -%}
                    {%- liquid
                        if settings.free_shipping_cart_drawer
                            render 'free-shipping'
                        endif
                    -%}

                    <div class="cart-drawer-items__wrapper flex--column">
                        {%- if cart_drawer_settings.enable_offer and cart_drawer_settings.offer_position == 'above_items' or cart_drawer_settings.offer_position == 'below_items' -%}
                            {% if cart_drawer_settings.icon != blank or cart_drawer_settings.custom_icon != blank or cart_drawer_settings.offer_heading != blank or cart_drawer_settings.offer_text != blank %}
                                <div class="section-block offer flex--column {{ cart_drawer_settings.offer_position }} {% if background_color_no_transparent %}bg-custom section-radius{% endif %}{% if text_color_no_transparent %} color-custom{% endif %}">
                                {%- if cart_drawer_settings.custom_icon != blank or cart_drawer_settings.icon != blank or cart_drawer_settings.offer_heading != blank -%}
                                <div class="offer__header flex--row">
                                    {%- if cart_drawer_settings.custom_icon != blank -%}
                                        {%- liquid
                                        assign widths = '20, 40, 60, 80, 100, 150, 300, 500, 750, 1000'
                                        assign img_class = "offer__icon"
                                    -%}
                                    {%- capture sizes -%}
                                        {{ cart_drawer_settings.icon_width }}px
                                    {%- endcapture -%}
                                    {% if settings.images_loading != 'disable' %}
                                        <figure class="lazy-image lazy-image--{{ settings.images_loading }}">
                                    {% endif %}
                                    {{
                                        cart_drawer_settings.custom_icon
                                        | image_url: width: 1000
                                        | image_tag:
                                        sizes: sizes,
                                        widths: widths,
                                        class: img_class,
                                        alt: cart_drawer_settings.custom_icon.alt,
                                        draggable: false,
                                        loading: 'lazy',
                                        onload: onload_script
                                    }}
                                    {% if settings.images_loading != 'disable' %}
                                        {% if settings.images_loading != 'fade_scale' %}
                                        <div class="lazy-image__preloader lazy-image__preloader--full lazy-image__preloader-{{ settings.images_loading }}" aria-hidden="true">
                                          <img 
                                          alt="{{ cart_drawer_settings.custom_icon.alt | escape }}" 
                                          src="{{ cart_drawer_settings.custom_icon | image_url: width: 10 }}"
                                          draggable="false"
                                          width="10" 
                                          height="10">
                                        </div>
                                        {% endif %}
                                    </figure>
                                    {% endif %}
                                    {%- else -%}
                                        {% if cart_drawer_settings.icon != blank %}
                                            {%- liquid
                                                assign icon_name = cart_drawer_settings.icon | split: '/'
                                                if icon_name.size == 3
                                                    assign file_name = icon_name.first | append: '_' | append: icon_name[1]
                                                elsif icon_name.size == 2
                                                    assign file_name = icon_name.first  
                                                endif
                                                assign icon = icon_name.last
                                                assign color_rgb = cart_drawer_settings.color | color_to_rgb | strip
                                                assign mobile_color_rgb = cart_drawer_settings.mobile_color | color_to_rgb | strip
                                                -%}
                                            <span class="offer__icon" style="--color: {{ color_rgb }}; --mobile-color: {{ mobile_color_rgb }};">{% render 'catalog-icons', file_name: file_name, icon: icon %}</span>
                                        {% endif %}
                                    {%- endif -%}
                                    {%- if cart_drawer_settings.offer_heading != blank -%}
                                      {% liquid
                                          assign heading_text = cart_drawer_settings.offer_heading
                                          assign processed_text = ''
                                          assign split_text = heading_text | split: '['

                                          for part in split_text
                                          if part contains ']'
                                              assign split_bracket = part | split: ']'
                                              assign highlight_text = split_bracket[0]
                                              assign after_bracket = split_bracket[1]
                                              assign processed_text = processed_text | append: '<span class="highlight"><span>' | append: highlight_text | append: '</span></span>' | append: after_bracket
                                          else
                                              assign processed_text = processed_text | append: part
                                          endif
                                          endfor


                                          assign final_text = ''
                                          assign split_text_curly = processed_text | split: '{'

                                          for part in split_text_curly
                                          if part contains '}'
                                              assign split_curly = part | split: '}'
                                              assign styled_text = split_curly[0]
                                              assign after_curly = split_curly[1]
                                              assign final_text = final_text | append: '<span class="styled">' | append: styled_text | append: '</span>' | append: after_curly
                                          else
                                              assign final_text = final_text | append: part
                                          endif
                                          endfor
                                      %}
                                    <p class="offer__heading custom-heading {{ cart_drawer_settings.offer_heading_style }}{% if offer_uppercase_heading %} uppercase{% endif %} 
                                    {% if cart_drawer_settings.offer_heading_style == 'subheading-font' and settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}">
                                        {% if cart_drawer_settings.offer_heading_style == 'subheading-font' and settings.bolder_subheadings_font %}<b>{% endif %}
                                            {{ final_text }}
                                        {% if cart_drawer_settings.offer_heading_style == 'subheading-font' and settings.bolder_subheadings_font %}</b>{% endif %}
                                    </p>
                                    {%- endif -%}
                                </div>
                                {%- endif -%}
                                {% liquid 
                                    assign uppercase_text = false
                                    if section.settings.offer_text_style == 'section-heading' and settings.uppercase_section_headings
                                        assign uppercase_text = true
                                    elsif section.settings.offer_text_style == 'secondary-heading' and settings.uppercase_secondary_headings
                                        assign uppercase_text = true
                                    elsif section.settings.offer_text_style == 'subheading-font' and settings.uppercase_subheadings
                                        assign uppercase_text = true
                                    elsif section.settings.offer_text_style == 'body-font' and settings.uppercase_body
                                        assign uppercase_text = true
                                    elsif section.settings.offer_text_style == 'caption-font' and settings.uppercase_caption
                                        assign uppercase_text = true
                                    endif
                                %}
                                {% if cart_drawer_settings.offer_text != blank %}
                                    <div class="richtext rte link-underline {{ cart_drawer_settings.offer_text_style }}
                                        {% if cart_drawer_settings.offer_text_style == 'subheading-font' %}{% if settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}{% if settings.uppercase_subheadings %} uppercase{% endif %}{% if settings.bolder_subheadings_font %} bold{% endif %}
                                        {% else %}{% if uppercase_text %} uppercase{% endif %}{% endif %}">
                                            {{ cart_drawer_settings.offer_text }}
                                    </div>
                                {% endif %}
                                </div>
                                {% endif %}
                        {%- endif -%}
                        <cart-drawer-items>
                            <form action="{{ routes.cart_url }}" id="CartDrawer-Form" class="cart__contents" method="post">
                            <div id="CartDrawer-CartItems" class="cart-drawer__contents">
                                <div class="cart-drawer__cart-items-wrapper">
                                    <table class="cart-items">
                                        <tbody>
                                            {%- for item in cart.items -%}
                                            {% liquid 
                                                case settings.sale_badge_style
                                                    when 'percentage'
                                                        assign discount = item.variant.compare_at_price | minus: item.final_price
                                                        assign discount_percent = discount | times: 100 | divided_by: item.variant.compare_at_price
                                                        assign sale_badge = discount_percent | round | prepend: '-' | append: '%'
                                                    when 'text'
                                                        assign sale_badge = 'products.product.badges.sale_badge' | t
                                                endcase
                                            %}
                                            <tr class="cart-item" id="CartDrawer-Item-{{ item.index | plus: 1 }}">
                                                <td class="cart-item__product">
                                                    {% if item.image or settings.product_placeholder %}
                                                    <span class="cart-item__media-wrapper">
                                                        <span class="cart-item__media aspect-ratio {% if settings.cart_fit_product_media %}cart-item__media--fit{% endif %}" {% if settings.disable_right_click %}oncontextmenu="return false"{% endif %}>
                                                            {% comment %} theme-check-disable ImgLazyLoading {% endcomment %}
                                                            {% if item.image %}
                                                            {% if settings.images_loading != 'disable' %}
                                                                <figure class="lazy-image lazy-image--{{ settings.images_loading }}">
                                                            {% endif %}
                                                            <img class="cart-item__image"
                                                                srcset="{{ item.image | image_url: width: 250 }} 1x, {{ item.image | image_url: width: 250 }} 2x"
                                                                src="{{ item.image | image_url: width: 250 }}"
                                                                alt="{{ item.image.alt | escape | split: '#' | first }}"
                                                                draggable="false"
                                                                loading="lazy"
                                                                {% if settings.images_loading != 'disable' %}onload="this.parentNode.classList.add('lazyloaded');" {% endif %}
                                                                width="250"
                                                                height="127"/>
                                                            {% if settings.images_loading != 'disable' %}
                                                                {% if settings.images_loading != 'fade_scale' %}
                                                                <div class="lazy-image__preloader lazy-image__preloader--full lazy-image__preloader-{{ settings.images_loading }}" aria-hidden="true">
                                                                    <img 
                                                                    alt="{{ item.image.alt | escape }}" 
                                                                    src="{{ item.image | image_url: width: 10 }}"
                                                                    draggable="false"
                                                                    width="10" 
                                                                    height="10">
                                                                </div>
                                                                {% endif %}
                                                            </figure>
                                                            {% endif %}
                                                            {% elsif settings.product_placeholder %}
                                                            {% if settings.images_loading != 'disable' %}
                                                                <figure class="lazy-image lazy-image--{{ settings.images_loading }}">
                                                            {% endif %}
                                                            <img class="cart-item__image cart-item__image--placeholder"
                                                                srcset="{{ settings.product_placeholder | image_url: width: 250 }} 1x, {{ settings.product_placeholder | image_url: width: 250 }} 2x"
                                                                src="{{ settings.product_placeholder | image_url: width: 250 }}"
                                                                alt="{{ settings.product_placeholder.alt | escape | split: '#' | first }}"
                                                                draggable="false"
                                                                loading="lazy"
                                                                {% if settings.images_loading != 'disable' %}onload="this.parentNode.classList.add('lazyloaded');" {% endif %}
                                                                width="250"
                                                                height="127"/>
                                                            {% if settings.images_loading != 'disable' %}
                                                                {% if settings.images_loading != 'fade_scale' %}
                                                                <div class="lazy-image__preloader lazy-image__preloader--full lazy-image__preloader-{{ settings.images_loading }}" aria-hidden="true">
                                                                    <img 
                                                                    alt="{{ settings.product_placeholder.alt | escape }}" 
                                                                    src="{{ settings.product_placeholder | image_url: width: 10 }}"
                                                                    draggable="false"
                                                                    width="10" 
                                                                    height="10">
                                                                </div>
                                                                {% endif %}
                                                            </figure>
                                                            {% endif %}
                                                            {% endif %}
                                                            {% comment %} theme-check-enable ImgLazyLoading {% endcomment %}
                                                        </span>
                                                    </span>
                                                    {% endif %}
                                                    <div class="cart-item__details body-font{% if settings.uppercase_body %} uppercase{% endif %}">
                                                        <div class="cart-item__first-row ">
                                                            {% if settings.card_show_title %}
                                                                {% liquid
                                                                assign product_title = item.product.title
                                                                if settings.max_product_name_characters != blank and settings.max_product_name_characters > 0
                                                                    assign product_title = item.product.title | truncate: settings.max_product_name_characters, ''
                                                                    if settings.max_product_name_characters < item.product.title.size
                                                                        assign product_title = product_title | append: '...'
                                                                    endif
                                                                endif 
                                                                %}
                                                                <a href="{{ item.product.url }}" class="cart-item__name{% if settings.small_use_accent_color_for_title %} color-accent{% endif %} {{ settings.small_product_titles_style }}{% if uppercase_product_title %} uppercase{% endif %}{% if settings.small_product_titles_style == 'subheading-font' and settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}">
                                                                    {% if settings.small_bolder_product_titles %}<b>{% endif %}{{ product_title }}{% if settings.small_bolder_product_titles %}</b>{% endif %}
                                                                </a>
                                                            {% endif %}                                                    
                                                            <div class="cart-item__totals right">
                                                                <div class="loading-overlay__spinner hidden">
                                                                    <svg class="spinner" width="24px" height="24px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                                                                    <circle class="path" fill="none" stroke-width="5" stroke-linecap="round" cx="33" cy="33" r="30"></circle>
                                                                </svg>
                                                                </div>
                                                                {% liquid 
                                                                    assign uppercase_price = false
                                                                    if settings.small_product_price_style == 'secondary-heading' and settings.uppercase_secondary_headings
                                                                    assign uppercase_price = true
                                                                    elsif settings.small_product_price_style == 'subheading-font' and settings.uppercase_subheadings
                                                                        assign uppercase_price = true
                                                                    elsif settings.small_product_price_style == 'body-font' and settings.uppercase_body
                                                                        assign uppercase_price = true
                                                                    elsif settings.small_product_price_style == 'caption-font' and settings.uppercase_caption
                                                                        assign uppercase_price = true
                                                                    endif
                                                                    if settings.small_product_titles_uppercase
                                                                    assign uppercase_price = true
                                                                    endif
                                                                %}
                                                                <div class="cart-item__price-wrapper {{ settings.small_product_price_style }}{% if uppercase_price %} uppercase{% else %} none-uppercase{% endif %}{% if settings.small_product_price_style == 'subheading-font' and settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}{% if settings.small_bolder_product_price %} bold{% endif %}">
                                                                    {%- if item.original_line_price != item.final_line_price -%}
                                                                    <dl class="cart-item__discounted-prices  flex--column">
                                                                        <dt class="visually-hidden">{{ 'products.product.price.sale_price' | t }}</dt>
                                                                        <dd class="price price--end">
                                                                            <price-money><bdi>{{ item.final_line_price | money }}</bdi></price-money>
                                                                        </dd>
                                                                    </dl>
                                                                    {%- else -%}
                                                                    <span class="price price--end">
                                                                        <price-money><bdi>{{ item.original_line_price | money }}</bdi></price-money>
                                                                    </span>
                                                                    {%- endif -%}
                                                                </div>
                                                            </div>
                                                        </div>
                                                        {% liquid 
                                                            assign uppercase_price = false
                                                            if settings.small_product_price_style == 'secondary-heading' and settings.uppercase_secondary_headings
                                                            assign uppercase_price = true
                                                            elsif settings.small_product_price_style == 'subheading-font' and settings.uppercase_subheadings
                                                                assign uppercase_price = true
                                                            elsif settings.small_product_price_style == 'body-font' and settings.uppercase_body
                                                                assign uppercase_price = true
                                                            elsif settings.small_product_price_style == 'caption-font' and settings.uppercase_caption
                                                                assign uppercase_price = true
                                                            endif
                                                            if settings.small_product_titles_uppercase
                                                            assign uppercase_price = true
                                                            endif
                                                        %}
                                                        <div class="cart-item__price-wrapper flex--row {{ settings.small_product_price_style }}{% if uppercase_price %} uppercase{% else %} none-uppercase{% endif %}{% if settings.small_bolder_product_price %} bold{% endif %}">
                                                            {%- if item.original_price != item.final_price -%}
                                                                {% liquid
                                                                    assign show_compare_at_price = false
                                                                  if settings.include_compare_at_price_in_before_discount and item.variant.compare_at_price and item.variant.compare_at_price > item.original_price
                                                                    assign show_compare_at_price = true
                                                                  endif
                                                                %}

                                                                <dl class="cart-item__discounted-prices flex--row">
                                                                    {% if settings.include_compare_at_price_in_before_discount %} 
                                                                        <dt class="visually-hidden">{{ 'products.product.price.sale_price' | t }}</dt>
                                                                        {% if show_compare_at_price %}
                                                                            <dd class="price price--end price--{{ settings.small_compare_at_price_color }}">
                                                                                <price-money><bdi>{{ item.original_price | money  }}</bdi></price-money>
                                                                            </dd> 
                                                                        {% else %}    
                                                                            <dd class="price">
                                                                                <s class="price price-item--regular price--end {% if settings.small_use_accent_color_for_price %}price--accent{% endif %}">
                                                                                    <price-money><bdi>{{ item.original_price | money  }}</bdi></price-money>
                                                                                </s>
                                                                            </dd> 
                                                                        {% endif %}                                                           
                                                                    {% else %}  
                                                                        <dt class="visually-hidden">{{ 'products.product.price.sale_price' | t }}</dt>
                                                                        <dd class="price price--end price--{{ settings.small_compare_at_price_color }}">
                                                                            <price-money><bdi>{{ item.final_price | money }}</bdi></price-money>
                                                                        </dd> 
                                                                        <dt class="visually-hidden">{{ 'products.product.price.regular_price' | t }}</dt>
                                                                        <dd class="price--on-sale">
                                                                            <s class="price price-item--regular price--end {% if settings.small_use_accent_color_for_price %}price--accent{% endif %}">
                                                                                <price-money><bdi>{{ item.original_price | money }}</bdi></price-money>
                                                                            </s>
                                                                        </dd>
                                                                    {% endif %}

                                                                    {% if show_compare_at_price %}
                                                                        <dt class="visually-hidden">{{ 'products.product.price.original_price' | t }}</dt>
                                                                        <dd class="price price--on-sale">
                                                                            <s class="price price-item--regular price--end {% if settings.small_use_accent_color_for_price %}price--accent{% endif %}">
                                                                                <price-money><bdi>{{ item.variant.compare_at_price | money }}</bdi></price-money>
                                                                            </s>
                                                                        </dd>
                                                                        {% if settings.show_badge_sale %}
                                                                            <span {% if settings.sale_badge_style == 'percentage' %}dir="ltr"{% endif %} class="card__badges-item card__badges-item--sale">{{ sale_badge }}</span>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                </dl>
                                                            {%- else -%}
                                                                {% if settings.include_compare_at_price_in_before_discount and item.variant.compare_at_price %}
                                                                    <span class="price price--end price--sale price--{{ settings.small_compare_at_price_color }}">
                                                                        <price-money><bdi>{{ item.final_price | money }}</bdi></price-money>
                                                                    </span>
                                                                    <span class="price price--on-sale {% if settings.small_use_accent_color_for_price %}price--accent{% endif %}">
                                                                        <price-money><bdi>{{ item.variant.compare_at_price | money }}</bdi></price-money>
                                                                    </span>
                                                                    {% if settings.show_badge_sale %}
                                                                        <span {% if settings.sale_badge_style == 'percentage' %}dir="ltr"{% endif %} class="card__badges-item card__badges-item--sale">{{ sale_badge }}</span>
                                                                    {% endif %}
                                                                {% else %}
                                                                    <span class="price price--end {% if settings.small_use_accent_color_for_price %}price--accent{% endif %}">
                                                                        <price-money><bdi>{{ item.final_price | money }}</bdi></price-money>
                                                                    </span>
                                                                {% endif %}
                                                            {%- endif -%}
                                                            {%- if item.variant.available and item.unit_price_measurement -%}
                                                            <div class="unit-price">
                                                            <span class="visually-hidden">{{ 'products.product.price.unit_price' | t }}</span>
                                                            <price-money><bdi>&#40;{{ item.variant.unit_price | money }}</bdi></price-money>
                                                            <span aria-hidden="true">/</span>
                                                            <span class="visually-hidden">&nbsp;{{ 'accessibility.unit_price_separator' | t }}&nbsp;</span>
                                                            {%- if item.variant.unit_price_measurement.reference_value != 1 -%}{{- item.variant.unit_price_measurement.reference_value -}}{%- endif -%}
                                                            {{ item.variant.unit_price_measurement.reference_unit }}&#41;
                                                            </div>
                                                            {%- endif -%}
                                                            {% if settings.show_badge_preorder and item.product.template_suffix == 'preorder' %}
                                                                <span class="product-badge--preorder caption-font{% if settings.uppercase_caption %} uppercase{% else %} none-uppercase{% endif %}">{{ 'products.product.pre_order' | t }}</span>
                                                            {% endif %}
                                                        </div>
                                                        {%- if settings.cart_show_vendor -%}<p class="cart-item__vendor">{{ item.product.vendor }}</p>{%- endif -%}
                                                        {%- if item.product.has_only_default_variant == false -%}
                                                            <dl>{%- for option in item.options_with_values -%}
                                                                <div class="product-option">
                                                                    <dt>{{ option.name }}</dt>
                                                                    <dd>{{ option.value | prepend: ': ' }}</dd>
                                                                </div>
                                                            {%- endfor -%}</dl>
                                                        {%- endif -%}
                                                        {%- unless item.properties == empty -%}
                                                            <dl>
                                                                {%- for property in item.properties -%}
                                                                    {%- assign property_first_char = property.first | slice: 0 -%}
                                                                    {%- if property.last != blank and property_first_char != '_' -%}
                                                                    <div class="product-option">
                                                                        <dt>{{ property.first }}: </dt>
                                                                        <dd>{%- if property.last contains '/uploads/' -%}
                                                                            <a href="{{ property.last }}" target="_blank">{{ property.last | split: '/' | last }}</a>
                                                                        {%- else -%}
                                                                            {{ property.last }}
                                                                        {%- endif -%}</dd>
                                                                    </div>
                                                                    {%- endif -%}
                                                                {%- endfor -%}
                                                            </dl>
                                                        {%- endunless -%}
                                                        {%- if item.selling_plan_allocation != nil -%}
                                                            <div class="product-option">{{ item.selling_plan_allocation.selling_plan.name }}</div>
                                                        {%- endif -%}
                                                        {%- if settings.inventory_notice_cart_drawer and item.variant.inventory_management -%}
                                                            {%- liquid
                                                                assign product_inventory = item.variant.inventory_quantity
                                                            -%}
                                                            {% if product_inventory <= settings.low_inventory and settings.inventory_notice == 'low' or settings.inventory_notice == 'yes' %}
                                                            {% if settings.show_count_inventory == 'yes' or settings.show_count_inventory == 'low' %}
                                                                <div class="cart-product__inventory cart-product__inventory--low">{{ 'cart.low_stock_with_count' | t: count: product_inventory }}</div>
                                                            {% endif %}
                                                            {% if settings.show_count_inventory == 'no' %}
                                                                <div class="cart-product__inventory cart-product__inventory--low">{{ 'cart.low_stock' | t }}</div>
                                                            {% endif %}
                                                            {% endif %}
                                                            {% if settings.inventory_notice == 'yes' and product_inventory > settings.low_inventory %}
                                                            {% if settings.show_count_inventory == 'yes' %}
                                                                <div class="cart-product__inventory">{{ 'cart.in_stock_with_count' | t: count: product_inventory }}</div>
                                                            {% endif %}
                                                            {% if settings.show_count_inventory == 'no' or settings.show_count_inventory == 'low' %}
                                                                <div class="cart-product__inventory">{{ 'cart.in_stock' | t }}</div>
                                                            {% endif %}
                                                            {% endif %}
                                                        {%- endif -%}
                                                        {%- if item.line_level_discount_allocations.size > 0 -%}
                                                            <ul class="discounts" role="list" aria-label="{{ 'customer.order.discount' | t }}">
                                                                {%- for discount in item.line_level_discount_allocations -%}
                                                                    {% liquid
                                                                        assign your_saved = 0
                                                                        assign your_saved = item.original_price | minus: item.final_price | times: item.quantity | plus: your_saved 
                                                                    %}
                                                                    <li class="discounts__discount {% if settings.uppercase_body %}uppercase{% endif %} flex--row">
                                                                        <span class="icon--small icon">{%- render 'glyphs_signs', icon: 'price-tag' -%}</span>
                                                                        {{ discount.discount_application.title }} <span dir="ltr">{% if your_saved > 0 %}{% if settings.currency_code_enabled %}(-{{ your_saved | money_with_currency }}){% else %}(-{{ your_saved | money }}){% endif %}{% endif %}</span>
                                                                    </li>
                                                                {%- endfor -%}
                                                            </ul>
                                                        {%- endif -%}
                                                        <div class="cart-item__details-actions">
                                                            <label class="visually-hidden" for="Drawer-quantity-{{ item.index | plus: 1 }}">{{ 'products.product.quantity.label' | t }}</label>
                                                            <quantity-input class="quantity flex--row">
                                                                <button class="quantity__button" name="minus" type="button" {% if item.quantity == 0 %}disabled{% endif %}>
                                                                    <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: item.product.title | escape }}</span>
                                                                    {%- render 'glyphs_interface', icon: 'minus' -%}
                                                                </button>
                                                                <input class="quantity__input"
                                                                type="number"
                                                                name="updates[]"
                                                                dir="ltr"
                                                                value="{{ item.quantity }}"
                                                                min="0"
                                                                {% if item.variant.quantity_rule.max != null %}
                                                                    max="{{ item.variant.quantity_rule.max }}"
                                                                {% endif %}
                                                                step="{{ item.variant.quantity_rule.increment }}"
                                                                aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                                                                id="Drawer-quantity-{{ item.index | plus: 1 }}"
                                                                data-index="{{ item.index | plus: 1 }}"
                                                                onclick="this.select();"/>
                                                                <button class="quantity__button no-js-hidden" name="plus" type="button">
                                                                    <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: item.product.title | escape }}</span>
                                                                    {%- render 'glyphs_interface', icon: 'plus' -%}
                                                                </button>
                                                            </quantity-input>
                                                            <cart-remove-button class="remove-button" id="CartDrawer-Remove-{{ item.index | plus: 1 }}" data-index="{{ item.index | plus: 1 }}">
                                                                <a href="{{ item.url_to_remove }}" class="" aria-label="{{ 'cart.remove_title' | t: title: item.title }}">
                                                                {{ 'cart.remove_button' | t }}
                                                                </a>
                                                            </cart-remove-button>
                                                        </div>
                                                        <p class="cart-item__error form__message errors" id="CartDrawer-LineItemError-{{ item.index | plus: 1 }}">
                                                            <span class="cart-item__error-text error-color"></span>
                                                        </p>
                                                    </div>
                                                </td>                  
                                            </tr>
                                            {%- endfor -%}
                                        </tbody>
                                    </table>
                                </div>
                                <p id="CartDrawer-LiveRegionText" class="visually-hidden" role="status"></p>
                                <p id="CartDrawer-LineItemStatus" class="visually-hidden" aria-hidden="true" role="status">{{ 'accessibility.loading' | t }}</p>
                            </div>
                        <div id="CartDrawer-CartErrors" role="alert" class="body-font {% if settings.uppercase_body %}uppercase{% endif %}"></div>
                        </form>
                    </cart-drawer-items>
                </div>
                {% if cart_drawer_settings.enable_order_note %}
                    <div class="accordion-order-note accordion accordion--compact">
                        <accordion-toggle>
                            <div class="accordion-toggle {% unless cart_drawer_settings.show_collapsible %}not_collapsible is-open{% endunless %}" {% unless cart_drawer_settings.show_collapsible %}open{% endunless %}>
                            <div class="accordion__summary"  tabindex="0">
                                <div class="summary__title">
                                    {%- liquid
                                        assign order_uppercase_heading = false
                                        if cart_drawer_settings.order_heading_style == 'section-heading' and settings.uppercase_section_headings
                                            assign order_uppercase_heading = true
                                        elsif cart_drawer_settings.order_heading_style == 'secondary-heading' and settings.uppercase_secondary_headings
                                            assign order_uppercase_heading = true
                                        elsif cart_drawer_settings.order_heading_style == 'subheading-font' and settings.uppercase_subheadings
                                            assign order_uppercase_heading = true
                                        elsif cart_drawer_settings.order_heading_style == 'body-font' and settings.uppercase_body
                                            assign order_uppercase_heading = true
                                        elsif cart_drawer_settings.order_heading_style == 'caption-font' and settings.uppercase_caption
                                            assign order_uppercase_heading = true
                                        endif

                                        assign heading_text = cart_drawer_settings.order_heading
                                        assign processed_text = ''
                                        assign split_text = heading_text | split: '['

                                        for part in split_text
                                        if part contains ']'
                                            assign split_bracket = part | split: ']'
                                            assign highlight_text = split_bracket[0]
                                            assign after_bracket = split_bracket[1]
                                            assign processed_text = processed_text | append: '<span class="highlight"><span>' | append: highlight_text | append: '</span></span>' | append: after_bracket
                                        else
                                            assign processed_text = processed_text | append: part
                                        endif
                                        endfor

                                        
                                        assign final_text = ''
                                        assign split_text_curly = processed_text | split: '{'

                                        for part in split_text_curly
                                        if part contains '}'
                                            assign split_curly = part | split: '}'
                                            assign styled_text = split_curly[0]
                                            assign after_curly = split_curly[1]
                                            assign final_text = final_text | append: '<span class="styled">' | append: styled_text | append: '</span>' | append: after_curly
                                        else
                                            assign final_text = final_text | append: part
                                        endif
                                        endfor
                                      -%}
                                    <div class="summary__title-name custom-heading {{ cart_drawer_settings.order_heading_style }}{% if order_uppercase_heading %} uppercase{% endif %} 
                                        {% if cart_drawer_settings.order_heading_style == 'subheading-font' and settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}">
                                        <h3 class="accordion__title">{% if cart_drawer_settings.order_heading_style == 'subheading-font' and settings.bolder_subheadings_font %}<b>{% endif %}
                                            {{ final_text }}
                                            {% if cart_drawer_settings.order_heading_style == 'subheading-font' and settings.bolder_subheadings_font %}</b>{% endif %}</h3>
                                    </div>
                                    <span class="icon-accordion icon-accordion--close">
                                        {%- render 'glyphs_interface', icon: 'plus' -%}
                                    </span>
                                    <span class="icon-accordion icon-accordion--open">
                                        {%- render 'glyphs_interface', icon: 'minus' -%}
                                    </span>
                                  </div>
                                </div>
                                <div class="accordion__panel hide-scrollbar">
                                    <div class="accordion__content body-font{% if settings.uppercase_body %} uppercase{% endif %}">
                                        <cart-note class="cart__note flex--column">
                                            {% if cart_drawer_settings.order_label != blank %}<label class="label" for="CartDrawer-Note">{{ cart_drawer_settings.order_label }}</label>{% endif %}
                                            <textarea class="textarea input" rows="3" name="note" id="CartDrawer-Note" placeholder="{{ cart_drawer_settings.order_placeholder | strip_html }}">{{ cart.note }}</textarea>
                                        </cart-note>
                                    </div>
                                </div>
                                </div>
                            </accordion-toggle>
                        </div>
                    {% endif %}
                {% if cart_drawer_settings.enable_shipping and template.name != 'cart' %}
                    <div class="accordion-shipping-calculator accordion accordion--compact">
                        <accordion-toggle>
                            <div class="accordion-toggle">
                            <div class="accordion__summary" tabindex="0">
                                <div class="summary__title">
                                    {%- liquid
                                        assign shipping_uppercase_heading = false
                                        if cart_drawer_settings.shipping_heading_style == 'section-heading' and settings.uppercase_section_headings
                                            assign shipping_uppercase_heading = true
                                        elsif cart_drawer_settings.shipping_heading_style == 'secondary-heading' and settings.uppercase_secondary_headings
                                            assign shipping_uppercase_heading = true
                                        elsif cart_drawer_settings.shipping_heading_style == 'subheading-font' and settings.uppercase_subheadings
                                            assign shipping_uppercase_heading = true
                                        elsif cart_drawer_settings.shipping_heading_style == 'body-font' and settings.uppercase_body
                                            assign shipping_uppercase_heading = true
                                            elsif cart_drawer_settings.shipping_heading_style == 'caption-font' and settings.uppercase_caption
                                            assign shipping_uppercase_heading = true
                                        endif

                                        assign heading_text = cart_drawer_settings.shipping_heading
                                        assign processed_text = ''
                                        assign split_text = heading_text | split: '['

                                        for part in split_text
                                        if part contains ']'
                                            assign split_bracket = part | split: ']'
                                            assign highlight_text = split_bracket[0]
                                            assign after_bracket = split_bracket[1]
                                            assign processed_text = processed_text | append: '<span class="highlight"><span>' | append: highlight_text | append: '</span></span>' | append: after_bracket
                                        else
                                            assign processed_text = processed_text | append: part
                                        endif
                                        endfor

                                        
                                        assign final_text = ''
                                        assign split_text_curly = processed_text | split: '{'

                                        for part in split_text_curly
                                        if part contains '}'
                                            assign split_curly = part | split: '}'
                                            assign styled_text = split_curly[0]
                                            assign after_curly = split_curly[1]
                                            assign final_text = final_text | append: '<span class="styled">' | append: styled_text | append: '</span>' | append: after_curly
                                        else
                                            assign final_text = final_text | append: part
                                        endif
                                        endfor
                                      -%}
                                    <div class="summary__title-name custom-heading {{ cart_drawer_settings.shipping_heading_style }}{% if shipping_uppercase_heading %} uppercase{% endif %} 
                                        {% if cart_drawer_settings.shipping_heading_style == 'subheading-font' and settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}">
                                        <h3 class="accordion__title">{% if cart_drawer_settings.shipping_heading_style == 'subheading-font' and settings.bolder_subheadings_font %}<b>{% endif %}
                                        {{ final_text }}
                                        {% if cart_drawer_settings.shipping_heading_style == 'subheading-font' and settings.bolder_subheadings_font %}</b>{% endif %}</h3>
                                    </div>
                                    <span class="icon-accordion icon-accordion--close">
                                        {%- render 'glyphs_interface', icon: 'plus' -%}
                                    </span>
                                    <span class="icon-accordion icon-accordion--open">
                                        {%- render 'glyphs_interface', icon: 'minus' -%}
                                    </span>
                                  </div>
                                </div>
                                <div class="accordion__panel hide-scrollbar">
                                    <div class="accordion__content body-font{% if settings.uppercase_body %} uppercase{% endif %}">                
                                    <shipping-calculator>                    
                                        <form-state class="fields-wrapper">
                                        <div class="field">
                                            <label class="label" for="ShippingCalculatorCountry">{{ 'cart.shipping_country' | t | append: '*' }}</label>
                                            <div class="select flex--row align-center">
                                                <select
                                                    id="ShippingCalculatorCountry"
                                                    class="input"
                                                    data-default="{% if shop.customer_accounts_enabled and customer %}{{ customer.default_address.country }}{% elsif cart_drawer_settings.shipping_country != '' %}{{ cart_drawer_settings.shipping_country }}{% endif %}"
                                                    autocomplete="country"
                                                    data-empty="---"
                                                    required>
                                                    {{ country_option_tags }}
                                                </select>
                                                <div class="select-icon flex--row align-center">
                                                    {%- render 'glyphs_arrows', icon: 'chevron-down' -%}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="field" id="ShippingCalculatorProvinceContainer" style="display: none">
                                            <label class="label" for="ShippingCalculatorProvince">{{ 'cart.shipping_state' | t }}</label>
                                            <div class="select flex--row align-center">
                                                <select
                                                    id="ShippingCalculatorProvince"
                                                    class="input"
                                                    data-default="{% if shop.customer_accounts_enabled and customer and customer.default_address.province != '' %}{{ customer.default_address.province }}{% endif %}"
                                                    autocomplete="address-level1">
                                                </select>
                                                <div class="select-icon flex--row align-center">
                                                    {%- render 'glyphs_arrows', icon: 'chevron-down' -%}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="field">
                                            <label class="label" for="ShippingCalculatorZip">{{ 'cart.zip' | t }}</label>
                                            <input id="ShippingCalculatorZip" class="input input--text input-style--big" type="text"{% if shop.customer_accounts_enabled and customer %} value="{{ customer.default_address.zip }}"{% endif %} autocapitalize="characters" autocomplete="postal-code" placeholder="{{ 'cart.zip_placeholder' | t }}"/>
                                        </div>
                                        <div class="field form__message errors hidden error-color" id="ShippingCalculatorErrors">
                                            <div class="errors"></div>
                                        </div>
                                        <div class="shipping-button">
                                            <button class="button solid-button body-font button--secondary{% if settings.use_heading_font_secondary_buttons %} heading-font-style{% endif %}{% if settings.uppercase_secondary_buttons %} uppercase{% endif %} button--submit" type="button">
                                                {% if settings.bolder_secondary_buttons_font %}<b>{% endif %}{{ 'cart.estimate' | t }}{% if settings.bolder_secondary_buttons_font %}</b>{% endif %}
                                            </button>
                                        </div>
                                        </form-state>
                                        <div class="field form__message hidden" id="ShippingCalculatorSuccess"></div>
                                    </shipping-calculator>
                                    </div>
                                </div>
                                </div>
                            </accordion-toggle>
                        </div>
                    {% endif %}

                    {% if cart_drawer_settings.enable_cart_recommendations %}
                        <div class="drawer-recommendations color-{{ section.settings.color_scheme }} 
                            {%- if enable_side_panel %} drawer-recommendations--side-panel scroll-area hide-scrollbar modal--shadow{% endif -%}              
                            {%- if recommendations_block_has_different_bg and cart_drawer_settings.cart_recommendations_desktop_style != 'side-panel' %} full-width-block{% endif -%}"
                        >
                            {%- case cart_drawer_settings.cart_recommendations_content -%}
                                {%- when 'both' -%}
                                    <div class="tabs-block tabs-block--block tabs-container-js">
                                        <slider-swiper class="swiper swiper-tabs js-cart-drawer-header {% if enable_side_panel %} cart-drawer__header{% endif %}" style="--total-slides: 2;" data-autoplay="false">
                                            <component-tabs class="swiper-wrapper tabs-block__tabs component-tabs__wrapper flex--row body-font">
                                                <p id="block-1--{{ section.id }}" class="swiper-slide tabs-block__heading component-tabs__tab tab-js active" tabindex="0" data-hover="{{ cart_drawer_settings.heading }}">
                                                    <span class="tabs-block__heading-wrapper">{{ cart_drawer_settings.heading }}</span>
                                                </p>
                                                <p id="block-2--{{ section.id }}" class="swiper-slide tabs-block__heading component-tabs__tab tab-js" tabindex="0" data-hover="{{ cart_drawer_settings.recently_viewed_heading }}">
                                                    <span class="tabs-block__heading-wrapper">{{ cart_drawer_settings.recently_viewed_heading }}</span>
                                                </p>                                  
                                                <h2 class="tabs-block__fallback-heading cart-recommendations__header {{ cart_drawer_settings.recommendations_heading_style }}
                                                {%- if section.settings.center_text %} center {% endif -%}         
                                                {%- if recommendations_uppercase_heading %} uppercase{% endif -%} 
                                                {%- if cart_drawer_settings.recommendations_heading_style == 'subheading-font' %}{% if settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}{% endif -%}">
                                                    {% if cart_drawer_settings.recommendations_heading_style == 'subheading-font' and settings.bolder_subheadings_font %}<b>{% endif %}                   
                                                    {% if cart_drawer_settings.recommendations_heading_style == 'subheading-font' and settings.bolder_subheadings_font %}</b>{% endif %}
                                                </h2>                        
                                            </component-tabs>
                                        </slider-swiper>
                                        <div class="tabs-block__results {% if enable_side_panel %} tabs-block__results--allow-height-change{% endif %}">
                                            <div id="content-block-1--{{ section.id }}" class="tab-content-js component-tabs__content active">
                                                {%- render 'cart-recommendations', cart_recommendations_settings: cart_drawer_settings, is_section: false, selector_container: '#CartDrawer', cart_drawer: true, is_cart_drawer_side_panel: enable_side_panel, no_heading: true -%}
                                            </div>
                                            <div id="content-block-2--{{ section.id }}" class="tab-content-js component-tabs__content">
                                                {%- render 'recently-viewed-products', is_section: false, no_heading: true, cart_drawer: true, is_cart_drawer_side_panel: enable_side_panel -%}
                                            </div>
                                        </div>
                                    </div>
                                {%- when 'related-products' -%}
                                    {%- render 'cart-recommendations', cart_recommendations_settings: cart_drawer_settings, is_section: false, selector_container: '#CartDrawer', cart_drawer: true, is_cart_drawer_side_panel: enable_side_panel, no_heading: false -%}
                                {%- when 'recently-viewed' -%}
                                    {%- render 'recently-viewed-products', is_section: false, cart_drawer: true, is_cart_drawer_side_panel: enable_side_panel, no_heading: false -%}
                            {%- endcase -%}
                        </div>
                    {% endif %}
                {%- endif -%}
            </div>
                {%- if cart != empty -%}
                    {% liquid 
                        if cart_drawer_settings.show_before_discounts or cart_drawer_settings.show_saved                              
                            if settings.include_compare_at_price_in_before_discount
                                assign before_discounts = 0
        
                                for item in cart.items
                                    assign compare_at_price = item.variant.compare_at_price
                                    assign compare_at_line_price = 0
        
                                    if compare_at_price
                                        assign compare_at_line_price = compare_at_price | times: item.quantity
                                    endif
        
                                    assign max_price = compare_at_line_price | at_least: item.original_line_price
                                    assign before_discounts = before_discounts | plus: max_price
                                endfor
                            else
                                assign before_discounts = cart.original_total_price
                            endif
        
                            assign savings = before_discounts | minus: cart.total_price
                        endif
                    %}
                    <div class="cart-drawer__footer flex--column modal--shadow">
                        {%- if cart_drawer_settings.enable_offer and cart_drawer_settings.offer_position == 'above_subtotal' or cart_drawer_settings.offer_position == 'below_checkout' -%}
                            {% if cart_drawer_settings.icon != blank or cart_drawer_settings.custom_icon != blank or cart_drawer_settings.offer_heading != blank or cart_drawer_settings.offer_text != blank %}
                                <div class="section-block offer flex--column {{ cart_drawer_settings.offer_position }} {% if background_color_no_transparent %}bg-custom section-radius{% endif %}{% if text_color_no_transparent %} color-custom{% endif %}">
                                {%- if cart_drawer_settings.custom_icon != blank or cart_drawer_settings.icon != blank or cart_drawer_settings.offer_heading != blank -%}
                                <div class="offer__header flex--row">
                                    {%- if cart_drawer_settings.custom_icon != blank -%}
                                        {%- liquid
                                        assign widths = '20, 40, 60, 80, 100, 150, 300, 500, 750, 1000'
                                        assign img_class = "offer__icon"
                                    -%}
                                    {%- capture sizes -%}
                                        {{ cart_drawer_settings.icon_width }}px
                                    {%- endcapture -%}
                                    {% if settings.images_loading != 'disable' %}
                                        <figure class="lazy-image lazy-image--{{ settings.images_loading }}">
                                    {% endif %}
                                    {{
                                        cart_drawer_settings.custom_icon
                                        | image_url: width: 1000
                                        | image_tag:
                                        sizes: sizes,
                                        widths: widths,
                                        class: img_class,
                                        alt: cart_drawer_settings.custom_icon.alt,
                                        draggable: false,
                                        loading: 'lazy',
                                        onload: onload_script
                                    }}
                                    {% if settings.images_loading != 'disable' %}
                                        {% if settings.images_loading != 'fade_scale' %}
                                        <div class="lazy-image__preloader lazy-image__preloader--full lazy-image__preloader-{{ settings.images_loading }}" aria-hidden="true">
                                          <img 
                                          alt="{{ cart_drawer_settings.custom_icon.alt | escape }}" 
                                          src="{{ cart_drawer_settings.custom_icon | image_url: width: 10 }}"
                                          draggable="false"
                                          width="10" 
                                          height="10">
                                        </div>
                                        {% endif %}
                                    </figure>
                                    {% endif %}
                                    {%- else -%}
                                        {% if cart_drawer_settings.icon != blank %}
                                            {%- liquid
                                                assign icon_name = cart_drawer_settings.icon | split: '/'
                                                if icon_name.size == 3
                                                    assign file_name = icon_name.first | append: '_' | append: icon_name[1]
                                                elsif icon_name.size == 2
                                                    assign file_name = icon_name.first  
                                                endif
                                                assign icon = icon_name.last
                                                assign color_rgb = cart_drawer_settings.color | color_to_rgb | strip
                                                assign mobile_color_rgb = cart_drawer_settings.mobile_color | color_to_rgb | strip
                                                -%}
                                            <span class="offer__icon" style="--color: {{ color_rgb }}; --mobile-color: {{ mobile_color_rgb }};">{% render 'catalog-icons', file_name: file_name, icon: icon %}</span>
                                        {% endif %}
                                    {%- endif -%}
                                    {%- if cart_drawer_settings.offer_heading != blank -%}
                                      {% liquid
                                          assign heading_text = cart_drawer_settings.offer_heading
                                          assign processed_text = ''
                                          assign split_text = heading_text | split: '['

                                          for part in split_text
                                          if part contains ']'
                                              assign split_bracket = part | split: ']'
                                              assign highlight_text = split_bracket[0]
                                              assign after_bracket = split_bracket[1]
                                              assign processed_text = processed_text | append: '<span class="highlight"><span>' | append: highlight_text | append: '</span></span>' | append: after_bracket
                                          else
                                              assign processed_text = processed_text | append: part
                                          endif
                                          endfor


                                          assign final_text = ''
                                          assign split_text_curly = processed_text | split: '{'

                                          for part in split_text_curly
                                          if part contains '}'
                                              assign split_curly = part | split: '}'
                                              assign styled_text = split_curly[0]
                                              assign after_curly = split_curly[1]
                                              assign final_text = final_text | append: '<span class="styled">' | append: styled_text | append: '</span>' | append: after_curly
                                          else
                                              assign final_text = final_text | append: part
                                          endif
                                          endfor
                                      %}
                                       <p class="offer__heading custom-heading {{ cart_drawer_settings.offer_heading_style }}{% if offer_uppercase_heading %} uppercase{% endif %} 
                                        {% if cart_drawer_settings.offer_heading_style == 'subheading-font' and settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}">
                                            {% if cart_drawer_settings.offer_heading_style == 'subheading-font' and settings.bolder_subheadings_font %}<b>{% endif %}
                                                {{ final_text }}
                                            {% if cart_drawer_settings.offer_heading_style == 'subheading-font' and settings.bolder_subheadings_font %}</b>{% endif %}
                                        </p>
                                    {%- endif -%}
                                </div>
                                {%- endif -%}
                                {% liquid 
                                    assign uppercase_text = false
                                    if section.settings.offer_text_style == 'subheading-font' and settings.uppercase_subheadings
                                        assign uppercase_text = true
                                    elsif section.settings.offer_text_style == 'body-font' and settings.uppercase_body
                                        assign uppercase_text = true
                                    elsif section.settings.offer_text_style == 'caption-font' and settings.uppercase_caption
                                        assign uppercase_text = true
                                    endif
                                %}
                                {% if cart_drawer_settings.offer_text != blank %}
                                    <div class="richtext rte link-underline {{ cart_drawer_settings.offer_text_style }}
                                        {% if cart_drawer_settings.offer_text_style == 'subheading-font' %}{% if settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}{% if settings.uppercase_subheadings %} uppercase{% endif %}{% if settings.bolder_subheadings_font %} bold{% endif %}
                                        {% else %}{% if uppercase_text %} uppercase{% endif %}{% endif %}">
                                            {{ cart_drawer_settings.offer_text }}
                                    </div>
                                {% endif %}
                                </div>
                                {% endif %}
                        {%- endif -%}
                        <div class="block-prices flex--column">
                            {%- liquid
                                assign uppercase_heading = false
                                if section.settings.headings_style == 'section-heading' and settings.uppercase_section_headings
                                assign uppercase_heading = true
                                elsif section.settings.headings_style == 'secondary-heading' and settings.uppercase_secondary_headings
                                assign uppercase_heading = true
                                elsif section.settings.headings_style == 'subheading-font' and settings.uppercase_subheadings
                                    assign uppercase_heading = true
                                elsif section.settings.headings_style == 'body-font' and settings.uppercase_body
                                    assign uppercase_heading = true
                                elsif section.settings.headings_style == 'caption-font' and settings.uppercase_caption
                                    assign uppercase_heading = true
                                endif
                            -%}
                            {%- if cart_drawer_settings.show_order_weight and cart.total_weight > 0 -%}
                                <div class="cart-weight body-font {% if settings.uppercase_body %}uppercase{% endif %}"><span class="{{ section.settings.headings_style }}{% if uppercase_heading %} uppercase{% endif %}{% if section.settings.headings_style == 'subheading-font' and settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}{% if section.settings.headings_style == 'subheading-font' and settings.bolder_subheadings_font %} bold{% endif %}">{{ 'cart.weight' | t }}</span><span>{{ cart.total_weight | weight_with_unit }}</span></div>
                            {%- endif -%}
                            {%- if cart_drawer_settings.show_before_discounts -%}
                                <div class="before-discounts-wrapper">
                                    <div class="before-discounts body-font{% if settings.uppercase_body %} uppercase{% endif %}">
                                    <p class="before-discounts__title {{ section.settings.headings_style }}{% if uppercase_heading %} uppercase{% endif %}{% if section.settings.headings_style == 'subheading-font' and settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}{% if section.settings.headings_style == 'subheading-font' and settings.bolder_subheadings_font %} bold{% endif %}">
                                        {{ 'cart.before_discounts' | t }}
                                    </p>
                                    <p class="before-discounts__value">{% if settings.currency_code_enabled %}{{ before_discounts | money_with_currency }}{% else %}{{ before_discounts | money }}{% endif %}</p>
                                    </div>
                                    {%- if cart.cart_level_discount_applications.size > 0 -%}
                                        <div class="discounts-wrapper body-font{% if settings.uppercase_body %} uppercase{% endif %} right">
                                            <ul class="discounts" role="list" aria-label="{{ 'customer.order.discount' | t }}">
                                                {%- for discount in cart.discount_applications -%}
                                                    <li class="discounts__discount discounts__discount--position flex--row">
                                                        <span class="icon--small icon">{%- render 'glyphs_signs', icon: 'price-tag' -%}</span>
                                                        {{ discount.title }}
                                                      <span dir="ltr">{% if settings.currency_code_enabled %}(-{{ discount.total_allocated_amount | money_with_currency }}){% else %}(-{{ discount.total_allocated_amount | money }}){% endif %}</span>
                                                    </li>
                                                {%- endfor -%}
                                            </ul>
                                        </div>
                                    {%- endif -%}
                                </div>
                            {% endif %}
                            {%- if cart_drawer_settings.show_saved and savings > 0 -%}
                                <div class="discount body-font{% if settings.uppercase_body %} uppercase{% endif %}" aria-label="{{ 'customer.order.discount' | t }}">
                                <p class="discount__title {{ section.settings.headings_style }}{% if uppercase_heading %} uppercase{% endif %}{% if section.settings.headings_style == 'subheading-font' and settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}{% if section.settings.headings_style == 'subheading-font' and settings.bolder_subheadings_font %} bold{% endif %}">{{ 'cart.saved' | t }}</p>
                                <p class="discount__value price--{{ settings.cart_compare_at_price_color }}">{% if settings.currency_code_enabled %}{{ savings | money_with_currency }}{% else %}{{ savings | money }}{% endif %}</p>
                                </div>
                            {%- endif -%}
                            {%- unless cart_drawer_settings.show_price_in_button -%}
                                {%- liquid
                                    assign uppercase_cart_total = false
                                    if section.settings.cart_total_style == 'section-heading' and settings.uppercase_section_headings
                                      assign uppercase_cart_total = true
                                    elsif section.settings.cart_total_style == 'secondary-heading' and settings.uppercase_secondary_headings
                                      assign uppercase_cart_total = true
                                    elsif section.settings.cart_total_style == 'subheading-font' and settings.uppercase_subheadings
                                        assign uppercase_cart_total = true
                                    elsif section.settings.cart_total_style == 'body-font' and settings.uppercase_body
                                        assign uppercase_cart_total = true
                                    elsif section.settings.cart_total_style == 'caption-font' and settings.uppercase_caption
                                        assign uppercase_cart_total = true
                                    endif
                                  -%}
                            <div class="totals {{ section.settings.cart_total_style }}{% if uppercase_cart_total %} uppercase{% endif %}{% if section.settings.cart_total_style == 'subheading-font' and settings.use_heading_font_subheadings %} subheading-heading-font{% endif %}
                                {% if section.settings.cart_total_style == 'subheading-font' and settings.bolder_subheadings_font %} bold{% endif %}">
                                <p class="totals__total">{%- if settings.cart_name == 'cart' -%}{{ 'cart.cart_total' | t }}{%- elsif settings.cart_name == 'basket' -%}{{ 'cart.basket_total' | t }}{%- else -%}{{ 'cart.bag_total' | t }}{%- endif -%}</p>
                                <p class="totals__total-value">{% if settings.currency_code_enabled %}{{ cart.total_price | money_with_currency }}{% else %}{{ cart.total_price | money }}{% endif %}</p>
                            </div>
                            {%- endunless -%}
                        </div>
                        {%- unless cart_drawer_settings.show_before_discounts -%}
                            {%- if cart.cart_level_discount_applications.size > 0 -%}
                                <div class="discounts-wrapper body-font{% if settings.uppercase_body %} uppercase{% endif %}">
                                    <ul class="discounts" role="list" aria-label="{{ 'customer.order.discount' | t }}">
                                        {%- for discount in cart.cart_level_discount_applications -%}
                                            <li class="discounts__discount discounts__discount--position flex--row">
                                                <span class="icon--small icon">{%- render 'glyphs_signs', icon: 'price-tag' -%}</span>
                                                {{ discount.title }}
                                                <span dir="ltr">{% if settings.currency_code_enabled %}(-{{ discount.total_allocated_amount | money_with_currency }}){% else %}(-{{ discount.total_allocated_amount | money }}){% endif %}</span>
                                            </li>
                                        {%- endfor -%}
                                    </ul>
                                </div>
                            {%- endif -%}
                        {%- endunless -%}  
                        {% if cart_drawer_settings.show_taxes %}
                            <small class="tax-note body-font {% if settings.uppercase_body %}uppercase{% endif %}">
                            {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
                                {{ 'cart.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url }}
                            {%- elsif cart.taxes_included -%}
                                {{ 'cart.taxes_included_but_shipping_at_checkout' | t }}
                            {%- elsif shop.shipping_policy.body != blank -%}
                                {{ 'cart.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url }}
                            {%- else -%}
                                {{ 'cart.taxes_and_shipping_at_checkout' | t }}
                            {%- endif -%}
                            </small>
                        {% endif %}
                        {%- if settings.enable_checkbox and settings.checkbox_label != blank -%}
                          <label class="field field--checkbox flex--row align-center body-font {% if settings.uppercase_body %}uppercase{% endif %}" for="checkbox--cart" form="CartDrawer-Form">
                              <input-checkbox>
                                  <input form="CartDrawer-Form" type="checkbox" id="checkbox--cart" name="enable-checkout" {%  if settings.make_required %}required{% endif %}>
                              </input-checkbox>
                              <span class="label richtext rte link-underline{% if settings.uppercase_section_headings %} headings-uppercase{% endif %}">{{ settings.checkbox_label }}</span>
                          </label>
                       {%- endif -%}
                        <div class="cart-drawer__footer-actions">
                          {%- if cart_drawer_settings.show_cart_button or cart_drawer_settings.show_cart_button == false and cart_drawer_settings.show_checkout_button == false -%}
                              <a href="{{ routes.cart_url }}" class="button outlined-button  body-font {% if section.settings.use_main_button %} button--main{% if settings.use_heading_font_main_buttons %} heading-font-style{% endif %}{% if settings.uppercase_main_buttons %} uppercase{% endif %}{% else %}
                                  button--secondary{% if settings.use_heading_font_secondary_buttons %} heading-font-style{% endif %}{% if settings.uppercase_secondary_buttons %} uppercase{% endif %}{% endif %}">
                                  {% if section.settings.use_main_button %}
                                      {% if settings.bolder_main_buttons_font %}<b>{% endif %}
                                          {% if settings.cart_name == 'cart' %}{{ 'cart_drawer.view_cart' | t }}{% elsif settings.cart_name == 'bag' %}{{ 'cart_drawer.view_bag' | t }}{% else %}{{ 'cart_drawer.view_basket' | t }}{% endif %}
                                      {% if settings.bolder_main_buttons_font %}</b>{% endif %}
                                  {% else %}
                                      {% if settings.bolder_secondary_buttons_font %}<b>{% endif %}
                                          {% if settings.cart_name == 'cart' %}{{ 'cart_drawer.view_cart' | t }}{% elsif settings.cart_name == 'bag' %}{{ 'cart_drawer.view_bag' | t }}{% else %}{{ 'cart_drawer.view_basket' | t }}{% endif %}
                                      {% if settings.bolder_secondary_buttons_font %}</b>{% endif %}
                                  {% endif %}
                              </a>
                              {%- endif -%}
                          {%- if cart_drawer_settings.show_checkout_button -%}
                          <div class="cart__checkout">
                              <button type="submit" id="CartDrawer-Checkout" class="cart__checkout-button button solid-button body-font {% if section.settings.use_main_button %} button--main{% if settings.use_heading_font_main_buttons %} heading-font-style{% endif %}{% if settings.uppercase_main_buttons %} uppercase{% endif %}{% else %}
                                  button--secondary{% if settings.use_heading_font_secondary_buttons %} heading-font-style{% endif %}{% if settings.uppercase_secondary_buttons %} uppercase{% endif %}{% endif %}" name="checkout"{% if cart == empty %} disabled{% endif %} form="CartDrawer-Form">
                                  {% if section.settings.use_main_button %}
                                      {% if settings.bolder_main_buttons_font %}<b>{% endif %}
                                          {{ 'cart.checkout' | t }} {% if cart_drawer_settings.show_price_in_button %}<span class="cart-drawer__button-price">{{ cart.total_price | money }}</span>{% endif %}
                                      {% if settings.bolder_main_buttons_font %}</b>{% endif %}
                                  {% else %}
                                      {% if settings.bolder_secondary_buttons_font %}<b>{% endif %}
                                          {{ 'cart.checkout' | t }} {% if cart_drawer_settings.show_price_in_button %}<span class="cart-drawer__button-price">{{ cart.total_price | money }}</span>{% endif %}
                                      {% if settings.bolder_secondary_buttons_font %}</b>{% endif %}
                                  {% endif %}
                              </button>
                          </div>
                          {%- endif -%}
                      </div>
                    </div>
                {%- endif -%}
        </div>
    </div>
</cart-drawer>

<script>
	document.addEventListener('DOMContentLoaded', function() {
	  function isIE() {
		const ua = window.navigator.userAgent;
		const msie = ua.indexOf('MSIE ');
		const trident = ua.indexOf('Trident/');
  
		return (msie > 0 || trident > 0);
	  }
  
	  if (!isIE()) return;
	  const cartSubmitInput = document.createElement('input');
	  cartSubmitInput.setAttribute('name', 'checkout');
	  cartSubmitInput.setAttribute('type', 'hidden');
	  document.querySelector('#cart').appendChild(cartSubmitInput);
	  document.querySelector('#checkout').addEventListener('click', function(event) {
		document.querySelector('#cart').submit();
	  });
	});
</script>