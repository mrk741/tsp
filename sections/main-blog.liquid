{{ 'section-main-blog.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign amount_block = blog.articles | size

  if section.settings.desktop_columns == '3' or section.settings.desktop_columns == '4' or section.settings.desktop_columns == '5'
    if amount_block > 2
      assign columns = section.settings.desktop_columns
    else
      assign columns = '2'
    endif
  else 
    assign columns = section.settings.desktop_columns
  endif

  assign mobile_columns = section.settings.mobile_columns
  if amount_block == 1
    assign mobile_columns = '1'
  endif

  assign section_framing = false
  if section.settings.section_framing != 'disable'
      assign section_framing = true
  endif

  assign onload_script = ''
  assign loading_images = ''
  if settings.images_loading != 'disable'
      assign onload_script = 'this.parentNode.classList.add("lazyloaded");' 
      assign loading_images = 'lazy'
  elsif section.index > 2
    assign loading_images = 'lazy'
  endif
-%}

{% style %}
    #shopify-section-{{ section.id }} {
        --grid-columns: {{ columns }};
        --aspect-ratio: {{ section.settings.media_ratio }};
        --top-spacing: {{ section.settings.top_spacing }};
        --bottom-spacing: {{ section.settings.bottom_spacing }};
        --focal-point: {{ section.settings.focal_point }};
    }

    {% if settings.images_loading != 'disable' and section.settings.media_ratio == 'auto' %}
      #shopify-section-{{ section.id }} .lazy-image {
        aspect-ratio: var(--asp-rat);
      }
    {% endif %}

    @media screen and (max-width: 1024px) {
        #shopify-section-{{ section.id }} {
            --grid-columns: {{ mobile_columns }};
        }
    }
{% endstyle %}

{%- liquid
    assign disable_max_width = false
    if section.settings.disable_max_width 
      assign disable_max_width = true
    elsif section.settings.grid_style == 'page' and settings.full_width_page_grid
      assign disable_max_width = true
    elsif section.settings.grid_style == 'alternative' and settings.full_width_alt_grid
      assign disable_max_width = true
    elsif section.settings.grid_style == 'secondary' and settings.full_width_second_grid
      assign disable_max_width = true
    endif

    assign max_width = '100vw'
    if disable_max_width == false and section.settings.grid_style == 'page'
        assign max_width = settings.page_width | append: 'px'
    elsif disable_max_width == false and section.settings.grid_style == 'alternative'
        assign max_width = settings.alt_grid_width | append: 'px'
    elsif disable_max_width == false and section.settings.grid_style == 'secondary'
        assign max_width = settings.second_grid_width | append: 'px'
    endif

    assign full_width = false
    if section.settings.full_width
      assign max_width = '100vw'
      assign full_width = true
    endif
-%}

<div id="ProductGridContainer--{{ section.id }}" class="section{% if section_framing == false or section.settings.full_width %} color-{{ section.settings.color_scheme }}{% endif %}{% unless section.settings.full_width %} side-margins{% endunless %}{% if section.settings.show_bottom_line %} bottom-line{% endif %}">
    <div class="blog section-container{% if section.settings.full_width == false %}{% if section_framing and section.settings.section_framing == 'grid' %} list {{ section.settings.grid_style }}-grid {% if disable_max_width %}disable-max-width{% endif %}{% endif %}{% unless section_framing %} list {{ section.settings.grid_style }}-grid{% if disable_max_width %} disable-max-width{% endif %}{% endunless %}{% endif %}">
      {% if section_framing and section.settings.full_width == false %}<div class="section-radius elem-padding-l color-{{ section.settings.color_scheme }}"><div {% if section.settings.section_framing != 'grid' %}class="list {{ section.settings.grid_style }}-grid{% if disable_max_width %} disable-max-width{% endif %}"{% endif %}>{% endif %}
        {% unless section.settings.hide_heading %}
          <div class="{% if section.settings.full_width %}side-margins{% endif %}">
            <h1 class="page-title {% if settings.uppercase_page_titles %}uppercase{% endif %}{% if section.settings.center_text %} center{% endif %}{% if section.settings.full_width %} {{ section.settings.grid_style }}-grid{% if disable_max_width %} disable-max-width{% endif %}{% endif %}">
              {{ blog.title | escape }} {% if section.settings.show_number_of_posts %}({{ blog.articles_count }}){% endif %}
            </h1>
          </div>
        {% endunless %}
        {%- if section.settings.enable_filtering_by_tags and blog.tags.size > 0 -%}
          <div class="{% if section.settings.full_width %}side-margins{% endif %}">
            <div class="blog__filters{% if section.settings.full_width %} {{ section.settings.grid_style }}-grid{% if disable_max_width %} disable-max-width{% endif %}{% endif %}">
                <ul class="blog__filters-list flex--row body-font {% if settings.uppercase_body %}uppercase{% endif %}">
                    <li><a href="{{ routes.root_url }}blogs/{{ blog.handle }}" class="blog__filters-link{% if current_tags == blank %} is-selected{% endif %}" data-hover="{{ 'blogs.article.all_tags' | t }}">
                      <span class="blog__filters-link-wrapper">{{ 'blogs.article.all_tags' | t }}</span>
                    </a></li>
                    {%- for tag in blog.all_tags -%}
                    <li><a href="{{ routes.root_url }}blogs/{{ blog.handle }}/tagged/{{ tag | handleize }}" class="blog__filters-link{% if current_tags contains tag %} is-selected{% endif %}" data-hover="{{ tag }}">
                      <span class="blog__filters-link-wrapper">{{ tag }}</span>
                    </a></li>
                    {%- endfor -%}
                </ul>
            </div>
          </div>
        {%- endif -%}
        {%- paginate blog.articles by section.settings.posts_per_page -%}
          <div id="product-grid--{{ section.id }}" class="blog__articles grid{% unless section.settings.disable_grid_gaps %} {{ section.settings.grid_style }}-grid-gaps{% endunless %}">
              {%- for article in blog.articles -%}
                  {%- render 'article-card',
                      article: article,
                      max_width: max_width,
                      show_image: section.settings.show_featured_image,
                      disable_max_width: disable_max_width,
                      desktop_columns: columns,
                      mobile_columns: mobile_columns,
                      post_color_scheme: section.settings.post_color_scheme,
                      show_post_border: section.settings.show_post_border,
                      full_width: full_width,
                      parent_section: 'blog_template',
                      loading_images: loading_images,
                      onload_script: onload_script
                    -%}
              {%- endfor -%}
          </div>
          {%- if paginate.pages > 1 -%}
              {%- render 'pagination', paginate: paginate, anchor: '', disable_max_width: disable_max_width, pagination_settings: section.settings, pagination_type: section.settings.pagination -%}
          {%- endif -%}
        {%- endpaginate -%}
      {% if section_framing and section.settings.full_width == false %}</div></div>{% endif %}
    </div>
</div>

{% schema %}
{
  "name": "t:sections.main-blog.name",
  "tag": "section",
  "class": "main-blog",
  "settings": [
    {
      "type": "checkbox",
      "id": "hide_heading",
      "default": false,
      "label": "t:sections.all.settings_titles.heading.hide_heading.label"
    },
    {
      "type": "checkbox",
      "id": "show_number_of_posts",
      "default": false,
      "label": "t:sections.main-blog.settings.show_number_of_posts.label"
    },
    {
      "type": "checkbox",
      "id": "enable_filtering_by_tags",
      "default": true,
      "label": "t:sections.main-blog.settings.enable_filtering_by_tags.label"
    },
    {
      "type": "checkbox",
      "id": "center_text",
      "default": false,
      "label": "t:sections.all.alignment.center_text.label"
    },
    {
      "type": "range",
      "id": "posts_per_page",
      "min": 4,
      "max": 24,
      "step": 2,
      "default": 12,
      "label": "t:sections.all.items_per_page.label"
    },
    {
      "type": "select",
      "id": "desktop_columns",
      "options": [
        {
          "value": "2",
          "label": "t:sections.all.columns.options__2.label"
        },
        {
          "value": "3",
          "label": "t:sections.all.columns.options__3.label"
        },
        {
          "value": "4",
          "label": "t:sections.all.columns.options__4.label"
        },
        {
          "value": "5",
          "label": "t:sections.all.columns.options__5.label"
        }
      ],
      "default": "2",
      "label": "t:sections.all.columns.desktop_columns.label"
    },
    {
      "type": "select",
      "id": "mobile_columns",
      "options": [
        {
          "value": "1",
          "label": "t:sections.all.columns.options__1.label"
        },
        {
          "value": "2",
          "label": "t:sections.all.columns.options__2.label"
        }
      ],
      "default": "1",
      "label": "t:sections.all.columns.mobile_columns.label"
    },
    {
      "type": "checkbox",
      "id": "show_featured_image",
      "default": true,
      "label": "t:sections.all.media.image.show_featured_image.label"
    },
    {
      "type": "select",
      "id": "media_ratio",
      "options": [
        {
          "value": "auto",
          "label": "t:sections.all.media.media_ratio.options__1.label"
        },
        {
          "value": "1/1",
          "label": "t:sections.all.media.media_ratio.options__2.label"
        },
        {
          "value": "4/5",
          "label": "t:sections.all.media.media_ratio.options__3.label"
        },
        {
          "value": "2/3",
          "label": "t:sections.all.media.media_ratio.options__4.label"
        },
        {
          "value": "4/3",
          "label": "t:sections.all.media.media_ratio.options__5.label"
        },
        {
          "value": "3/2",
          "label": "t:sections.all.media.media_ratio.options__6.label"
        },
        {
          "value": "16/9",
          "label": "t:sections.all.media.media_ratio.options__7.label"
        },
        {
          "value": "4/1",
          "label": "t:sections.all.media.media_ratio.options__8.label"
        }
      ],
      "default": "4/1",
      "label": "t:sections.all.media.media_ratio.label"
    },
    {
      "type": "select",
      "id": "focal_point",
      "options": [
        {
          "value": "20% 0",
          "label": "t:sections.all.media.focal_point.options__1.label"
        },
        {
          "value": "top center",
          "label": "t:sections.all.media.focal_point.options__2.label"
        },
        {
          "value": "80% 0",
          "label": "t:sections.all.media.focal_point.options__3.label"
        },
        {
          "value": "20% 50%",
          "label": "t:sections.all.media.focal_point.options__4.label"
        },
        {
          "value": "center center",
          "label": "t:sections.all.media.focal_point.options__5.label"
        },
        {
          "value": "80% 50%",
          "label": "t:sections.all.media.focal_point.options__6.label"
        },
        {
          "value": "20% 100%",
          "label": "t:sections.all.media.focal_point.options__7.label"
        },
        {
          "value": "bottom center",
          "label": "t:sections.all.media.focal_point.options__8.label"
        },
        {
          "value": "80% 100%",
          "label": "t:sections.all.media.focal_point.options__9.label"
        }
      ],
      "default": "center center",
      "label": "t:sections.all.media.focal_point.label"
    },
    {
      "type": "checkbox",
      "id": "show_post_border",
      "default": false,
      "label": "t:sections.all.show_frame.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.pagination.content"
    },
    {
      "type": "select",
      "id": "pagination",
      "options": [
        {
          "value": "paginated",
          "label": "t:sections.all.pagination.options__1.label"
        },
        {
          "value": "infinite",
          "label": "t:sections.all.pagination.options__2.label"
        },
        {
          "value": "click",
          "label": "t:sections.all.pagination.options__3.label"
        }
      ],
      "default": "paginated",
      "label": "t:sections.all.pagination.pagination_style.label"
    },
    {
      "type": "text",
      "id": "pagination_button_label",
      "label": "t:sections.all.settings_titles.label.label",
      "default": "Load more"
    },
    {
      "type": "text",
      "id": "pagination_button_icon",
      "label": "t:sections.all.buttons.button_icon.label",
      "info": "t:sections.all.icons.icon.info"
    },
    {
      "type": "checkbox",
      "id": "swap_pagination_button_icon",
      "default": false,
      "label": "t:sections.all.icons.swap_icon_position.label"
    },
    {
      "type": "select",
      "id": "pagination_button_style",
      "options": [
        {
          "value": "solid",
          "label": "t:sections.all.buttons.button_styles.options__1.label"
        },
        {
          "value": "outlined",
          "label": "t:sections.all.buttons.button_styles.options__2.label"
        },
        {
          "value": "link",
          "label": "t:sections.all.buttons.button_styles.options__3.label"
        }
      ],
      "default": "solid",
      "label": "t:sections.all.buttons.button_styles.button_style.label"
    },
    {
      "type": "checkbox",
      "id": "use_main_button_pagination",
      "default": false,
      "label": "t:sections.all.buttons.use_main_button.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.settings_titles.section_layout_header.content"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": false,
      "label": "t:sections.all.full_width.label"
    },
    {
      "type": "select",
      "id": "grid_style",
      "options": [
        {
          "value": "page",
          "label": "t:sections.all.grid_style.options__1.label"
        },
        {
          "value": "secondary",
          "label": "t:sections.all.grid_style.options__3.label"
        },
        {
          "value": "alternative",
          "label": "t:sections.all.grid_style.options__2.label"
        }
      ],
      "default": "page",
      "label": "t:sections.all.grid_style.label"
    },
    {
      "type": "checkbox",
      "id": "disable_max_width",
      "default": false,
      "label": "t:sections.all.disable_max_width.label"
    },
    {
      "type": "checkbox",
      "id": "disable_grid_gaps",
      "default": false,
      "label": "t:sections.all.disable_grid_gaps.label"
    },
    {
      "type": "checkbox",
      "id": "show_bottom_line",
      "default": false,
      "label": "t:sections.all.show_bottom_line.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.colors.header.content"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.color_scheme.label",
      "default": "background-1"
    },
    {
      "type": "color_scheme",
      "id": "post_color_scheme",
      "label": "t:sections.all.colors.post_color_scheme.label",
      "default": "background-1"
    },
    {
      "type": "select",
      "id": "section_framing",
      "options": [
        {
          "value": "disable",
          "label": "t:sections.all.section_framing.options__1.label"
        },
        {
          "value": "enable",
          "label": "t:sections.all.section_framing.options__2.label"
        },
        {
          "value": "grid",
          "label": "t:sections.all.section_framing.options__3.label"
        }
      ],
      "default": "disable",
      "label": "t:sections.all.section_framing.label",
      "info": "t:sections.all.section_framing.info"
    },
    {
      "type": "header",
      "content": "t:sections.all.spacing.header.content"
    },
    {
      "type": "range",
      "id": "top_spacing",
      "min": 0,
      "max": 2,
      "step": 0.1,
      "unit": "x",
      "label": "t:sections.all.spacing.top_spacing.label",
      "default": 1
    },
    {
      "type": "range",
      "id": "bottom_spacing",
      "min": 0,
      "max": 2,
      "step": 0.1,
      "unit": "x",
      "label": "t:sections.all.spacing.bottom_spacing.label",
      "default": 1
    }
  ],
  "blocks": [
    {
      "type": "title",
      "name": "t:blocks.title.name",
      "settings": [
        {
          "type": "paragraph",
          "content": "t:sections.main-blog.blocks.title.settings.paragraph__1.content"
        },
        {
          "type": "select",
          "id": "title_style",
          "options": [
            {
              "value": "caption-font",
              "label": "t:sections.all.headings_style.options__6.label"
            },
            {
              "value": "body-font",
              "label": "t:sections.all.headings_style.options__1.label"
            },
            {
              "value": "subheading-font",
              "label": "t:sections.all.headings_style.options__2.label"
            },
            {
              "value": "secondary-heading",
              "label": "t:sections.all.headings_style.options__3.label"
            },
            {
              "value": "section-heading",
              "label": "t:sections.all.headings_style.options__4.label"
            }
          ],
          "default": "secondary-heading",
          "label": "t:sections.all.headings_style.title_style.label"
        },
        {
          "type": "checkbox",
          "id": "use_accent_color",
          "default": false,
          "label": "t:sections.all.colors.use_accent_color.label"
        }
      ]
    },
    {
      "type": "info",
      "name": "t:blocks.article_info.name",
      "settings": [
        {
          "type": "checkbox",
          "id": "show_date",
          "default": true,
          "label": "t:blocks.article_info.settings.show_date.label"
        },
        {
          "type": "checkbox",
          "id": "show_author",
          "default": true,
          "label": "t:blocks.article_info.settings.show_author.label"
        },
        {
          "type": "checkbox",
          "id": "show_number_of_comments",
          "default": false,
          "label": "t:blocks.article_info.settings.show_number_of_comments.label"
        },
        {
          "type": "select",
          "id": "text_style",
          "options": [
            {
              "value": "caption-font",
              "label": "t:sections.all.headings_style.options__6.label"
            },
            {
              "value": "body-font",
              "label": "t:sections.all.headings_style.options__1.label"
            },
            {
              "value": "subheading-font",
              "label": "t:sections.all.headings_style.options__2.label"
            },
            {
              "value": "secondary-heading",
              "label": "t:sections.all.headings_style.options__3.label"
            },
            {
              "value": "section-heading",
              "label": "t:sections.all.headings_style.options__4.label"
            }
          ],
          "default": "body-font",
          "label": "t:sections.all.headings_style.text_style.label"
        }
      ]
    },
    {
      "type": "excerpt",
      "name": "t:blocks.excerpt.name",
      "settings": [
        {
          "type": "paragraph",
          "content": "t:blocks.excerpt.settings.paragraph__1.content"
        },
        {
          "type": "range",
          "id": "excerpt_line_limit",
          "min": 1,
          "max": 5,
          "step": 1,
          "label": "t:blocks.excerpt.settings.excerpt_line_limit.label",
          "info": "t:blocks.excerpt.settings.excerpt_line_limit.info",
          "default": 2
        },
        {
          "type": "select",
          "id": "text_style",
          "options": [
            {
              "value": "caption-font",
              "label": "t:sections.all.headings_style.options__6.label"
            },
            {
              "value": "body-font",
              "label": "t:sections.all.headings_style.options__1.label"
            },
            {
              "value": "subheading-font",
              "label": "t:sections.all.headings_style.options__2.label"
            },
            {
              "value": "secondary-heading",
              "label": "t:sections.all.headings_style.options__3.label"
            },
            {
              "value": "section-heading",
              "label": "t:sections.all.headings_style.options__4.label"
            }
          ],
          "default": "body-font",
          "label": "t:sections.all.headings_style.text_style.label"
        }
      ]
    },
    {
      "type": "read_more",
      "name": "t:blocks.read_more.name",
      "settings": [
        {
          "type": "text",
          "id": "button_label",
          "default": "Keep reading",
          "label": "t:sections.all.buttons.button_label.label",
          "info": "t:sections.all.buttons.button_label.info"
        },
        {
          "type": "text",
          "id": "button_icon",
          "label": "t:sections.all.buttons.button_icon.label",
          "info": "t:sections.all.icons.icon.info"
        },
        {
          "type": "checkbox",
          "id": "swap_button_icon",
          "default": false,
          "label": "t:sections.all.icons.swap_icon_position.label"
        },
        {
          "type": "checkbox",
          "id": "target_blank",
          "default": false,
          "label": "t:sections.all.link.target_blank.label"
        },
        {
          "type": "select",
          "id": "button_style",
          "options": [
            {
              "value": "solid",
              "label": "t:sections.all.buttons.button_styles.options__1.label"
            },
            {
              "value": "outlined",
              "label": "t:sections.all.buttons.button_styles.options__2.label"
            },
            {
              "value": "link",
              "label": "t:sections.all.buttons.button_styles.options__3.label"
            }
          ],
          "default": "link",
          "label": "t:sections.all.buttons.button_styles.button_style.label"
        }
      ]
    }
  ],
  "default": {
    "blocks": [
      {
        "type": "title"
      },
      {
        "type": "info"
      },
      {
        "type": "excerpt"
      }
    ]
  }
}
{% endschema %}